# Authentication

MemoryGate supports two authentication paths:

1. MCP auth gate for tool access (API keys).
2. OAuth login for user sessions and API key management.

## API Keys (MCP)

- API keys are generated by the server and stored as bcrypt hashes.
- Keys use the mg_ prefix and are accepted via:
  - Authorization: Bearer mg_...
  - X-API-Key: mg_...

The MCP auth gate is enabled by default. Disable it only for local development:

```bash
export REQUIRE_MCP_AUTH=false
```

## OAuth Discovery (MCP Clients)

Claude Desktop and other MCP clients use the OAuth discovery endpoints:

- /.well-known/oauth-authorization-server
- /.well-known/openid-configuration
- /.well-known/oauth-protected-resource

The flow is PKCE-based and backed by the PSTRYDER_DESKTOP credentials:

```bash
export PSTRYDER_DESKTOP="client-id"
export PSTRYDER_DESKTOP_SECRET="client-secret"
export PSTRYDER_DESKTOP_REDIRECT_URIS="https://claude.ai/api/mcp/callback"
```

The client exchanges an authorization code for an API key at /oauth/token.

## Client Credentials (Server-to-Server)

For programmatic access, POST to /auth/client:

```bash
curl -X POST http://localhost:8080/auth/client \
  -H "Content-Type: application/json" \
  -d '{"client_id": "YOUR_ID", "client_secret": "YOUR_SECRET"}'
```

This returns an API key for the client.

## OAuth Login (Google/GitHub)

User login uses provider OAuth for session cookies:

- /auth/login/google
- /auth/login/github

Configure providers with:

```bash
export GOOGLE_CLIENT_ID="..."
export GOOGLE_CLIENT_SECRET="..."
export GITHUB_CLIENT_ID="..."
export GITHUB_CLIENT_SECRET="..."
```

## API Key Management

Authenticated users can manage API keys via:

- GET /auth/me
- POST /auth/api-keys
- GET /auth/api-keys
- DELETE /auth/api-keys/{key_id}

Sessions are stored in the mg_session cookie. Use /auth/logout to revoke
sessions and clear the cookie.
